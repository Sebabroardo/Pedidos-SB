<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Santa Roti</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #c62828; color: #fff; padding: 1rem; text-align: center; }
    #products { display: flex; flex-wrap: wrap; gap: 1rem; padding: 1rem; }
    .product { border: 1px solid #ccc; border-radius: 8px; padding: 1rem; width: 200px; }
    .product h3 { margin: 0; font-size: 1.2rem; }
    .product p { margin: 0.5rem 0; }
    .product button { background: #2e7d32; color: white; border: none; padding: 0.5rem; cursor: pointer; border-radius: 4px; }
    #cart { position: fixed; top: 0; right: 0; width: 300px; height: 100%; background: #f5f5f5; border-left: 1px solid #ccc; padding: 1rem; overflow-y: auto; }
    #cart h2 { margin-top: 0; }
    #checkout { margin-top: 1rem; background: #c62828; color: white; border: none; padding: 0.5rem; width: 100%; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Santa Roti</h1>
  </header>
  <main>
    <div id="products"></div>
    <aside id="cart">
      <h2>Carrito</h2>
      <ul id="cart-items"></ul>
      <p>Total: $<span id="total">0</span></p>
      <button id="checkout">Finalizar pedido</button>
    </aside>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ConfiguraciÃ³n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAou7COlKKf0mJCnwEefntTKVGI2cxxJrU",
      authDomain: "santa-roti.firebaseapp.com",
      projectId: "santa-roti",
      storageBucket: "santa-roti.firebasestorage.app",
      messagingSenderId: "66221970620",
      appId: "1:66221970620:web:53083ce7727ff85e6d2cb9",
      measurementId: "G-BMXRPFDDJQ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const productsDiv = document.getElementById("products");
    const cartItems = document.getElementById("cart-items");
    const totalSpan = document.getElementById("total");
    const checkoutBtn = document.getElementById("checkout");

    let cart = [];

    async function renderProducts() {
      const snapshot = await getDocs(collection(db, "productos"));
      productsDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const p = doc.data();
        p.id = doc.id; // ðŸ‘ˆ agregamos el id del doc
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <h3>${p.name}</h3>
          <p>${p.description}</p>
          <p><strong>$${p.price}</strong></p>
          <button onclick="addToCart('${p.id}', '${p.name}', ${p.price})">Agregar</button>
        `;
        productsDiv.appendChild(div);
      });
    }

    window.addToCart = function(id, name, price) {
      cart.push({ id, name, price });
      renderCart();
    };

    function renderCart() {
      cartItems.innerHTML = "";
      let total = 0;
      cart.forEach((item, index) => {
        total += item.price;
        const li = document.createElement("li");
        li.textContent = `${item.name} - $${item.price}`;
        const removeBtn = document.createElement("button");
        removeBtn.textContent = "x";
        removeBtn.style.marginLeft = "10px";
        removeBtn.onclick = () => { cart.splice(index,1); renderCart(); };
        li.appendChild(removeBtn);
        cartItems.appendChild(li);
      });
      totalSpan.textContent = total;
    }

    checkoutBtn.addEventListener("click", () => {
      if(cart.length===0) return alert("El carrito estÃ¡ vacÃ­o");
      let msg = "Hola, quiero pedir:\n";
      cart.forEach(item => {
        msg += `- ${item.name} ($${item.price})\n`;
      });
      msg += `Total: $${totalSpan.textContent}`;
      const phone = "543537581341"; // ðŸ“² tu nÃºmero en formato internacional
      window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, "_blank");
    });

    renderProducts();
  </script>
</body>
</html>
