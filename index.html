<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Santa Rotiser√≠a ‚Äî Pedidos por WhatsApp</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#ffffff;
  --card:#f8f8f8;
  --muted:#4b5563;
  --text:#000000;
  --primary:#22c55e;
  --accent:#f43f5e;
  --ring:#d1d5db;
}
*{box-sizing:border-box}
html, body {
  margin: 0;
  height: 100%;
  font-family: STAATLICHES;
  background: url('Fondo.png') repeat center center;
  background-size: auto;
  color: var(--text);
}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:24px}
header{display:flex;align-items:center;justify-content:space-between;padding:18px 0}
.brand{display:flex;gap:12px;align-items:center}
.logo {width: 64px;height: 64px;border-radius: 12px;overflow: hidden;display: flex;align-items: center;justify-content: center;background: none;}
.logo img {width: 100%;height: 100%;object-fit: contain;}
.brand h1{font-size:20px;margin:0}
.tag{font-size:12px;color:var(--muted)}
.hero{
  padding:18px;
  border:1px solid var(--ring);
  border-radius:20px;
  display:grid;
  grid-template-columns:1.3fr .7fr;
  gap:18px;
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(4px);
}
.hero .copy h2{font-size:20px;margin:0 0 8px}
.hero .copy p{margin:0;color:#000}
.hero .info{display:grid;gap:8px;align-content:start}
.pill{display:inline-flex;gap:8px;align-items:center;background:#f8f8f8;border:1px solid var(--ring);border-radius:999px;padding:8px 12px;font-size:12px;color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:8px;transition:max-height 0.3s ease, opacity 0.3s ease;overflow:hidden;opacity:0;max-height:0}
.grid.show{opacity:1;max-height:2000px}
.card{background: rgba(255,255,255,0.95); border:1px solid var(--ring); border-radius:18px; padding:14px; backdrop-filter: blur(4px);}
.product{display:flex;flex-direction:column;gap:10px}
.product .img{height:140px;border-radius:14px;background:#ffffff;border:1px dashed #d1d5db;display:grid;place-items:center;font-size:12px;color:#6b7280;overflow:hidden}
.product img{width:100%;height:100%;object-fit:cover;border-radius:14px}
.product h3{margin:0;font-size:16px}
.product p{margin:0;color:var(--muted);font-size:13px}
.price{font-weight:700}
.qty{display:flex;align-items:center;gap:8px;margin-top:4px}
.qty button{width:28px;height:28px;border-radius:8px;border:1px solid var(--ring);background:#f8f8f8;color:var(--text);cursor:pointer}
.actions{display:flex;gap:8px;justify-content:space-between;align-items:center}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);background:#f8f8f8;color:var(--text);cursor:pointer}
.btn.primary{background:linear-gradient(180deg,#23d164,#18b956);border:none;color:#ffffff;font-size:15px;font-weight:600;padding:12px 14px;}
.category-btn{
  cursor:pointer;
  font-size:18px;
  margin:12px 0;
  display:flex;
  align-items:center;
  gap:6px;
  color:var(--text);
  font-weight:600;
  border:1px solid var(--ring);
  background: rgba(255,255,255,0.9);
  padding:8px 12px;
  border-radius:10px;
  transition: background 0.2s ease;
}
.category-btn:hover{background:rgba(255,255,255,1)}
.col-9{grid-column:span 9}
.col-3{grid-column:span 3}
@media (max-width:900px){.hero{grid-template-columns:1fr}.col-9,.col-3{grid-column:1/-1}}
.cart{position:sticky;top:12px;display:grid;gap:10px;background: rgba(255,255,255,0.95); border:1px solid var(--ring); border-radius:18px; backdrop-filter: blur(4px);}
.cart h3{margin:0 0 6px}
.cart-list{display:grid;gap:8px;max-height:360px;overflow:auto;padding-right:6px}
.cart-item{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px;border:1px solid var(--ring);border-radius:12px;background:#f8f8f8}
.cart-item .title{font-size:13px}
.tot{display:flex;align-items:center;justify-content:space-between;font-weight:800}
.muted{color:var(--muted);font-size:12px}
.inputs{display:grid;gap:10px}
.inputs input, .inputs textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);background:#f8f8f8;color:var(--text)}
.inputs textarea{min-height:72px;resize:vertical}
/* Footer m√°s legible */
footer {
  margin-top: 22px;
  color: var(--muted);
  font-size: 12px;
  text-align: center;
  background: rgba(255,255,255,0.9);
  padding: 10px;
  border-radius: 12px;
}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo">
        <img src="logo.png" alt="Santa Rotiser√≠a">
      </div>
      <div>
        <h1>Santa</h1>
        <div class="tag">Rotiser√≠a ‚Äî Pedidos por WhatsApp</div>
      </div>
    </div>
    <div class="pill">‚è±Ô∏è Hoy: 20:00 ‚Äì 23:30¬∑ üìç Cintra</div>
  </header>

  <section class="hero">
    <div class="copy">
      <h2>Hac√© tu pedido online y confirmalo por WhatsApp</h2>
      <p>Eleg√≠ tu pedido, agregalo al carrito y presion√° ‚ÄúEnviar por WhatsApp‚Äù. Te llega el mensaje listo para confirmar con nuestra atenci√≥n.</p>
    </div>
    <div class="info">
      <div class="pill">üöö Env√≠os y retiro en local</div>
      <div class="pill">üí≥ Efectivo, D√©bito/Cr√©dito, QR</div>      
    </div>
  </section>

  <section class="col-9">
    <button class="category-btn" data-target="pizzas">Pizzas ‚ñ∏</button>
    <div id="pizzas" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));"></div>

    <button class="category-btn" data-target="hamburguesas">Hamburguesas ‚ñ∏</button>
    <div id="hamburguesas" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));"></div>

    <button class="category-btn" data-target="papas">Papas ‚ñ∏</button>
    <div id="papas" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));"></div>

    <button class="category-btn" data-target="menuEspecial">Men√∫ Especial ‚ñ∏</button>
    <div id="menuEspecial" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));"></div>

    <button class="category-btn" data-target="extras">Extras ‚ñ∏</button>
    <div id="extras" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr));"></div>
  </section>

  <aside class="col-3">
    <div class="card cart">
      <h3>üõí Tu pedido</h3>
      <div class="cart-list" id="cartList"></div>
      <div class="tot"><span>Total</span><span id="total">$0</span></div>
      <div class="inputs">
        <input id="customerName" placeholder="Tu nombre"/>
        <input id="customerAddress" placeholder="Direcci√≥n (si ped√≠s env√≠o)"/>
        <textarea id="customerNotes" placeholder="Notas para la cocina (sin mayonesa, m√°s ketchup, etc.)"></textarea>
      </div>
      <button class="btn primary" id="whatsBtn">üì≤ Enviar pedido por WhatsApp</button>
      <div class="muted">Al hacer clic se abrir√° WhatsApp con el detalle de tu pedido para confirmar.</div>
    </div>
  </aside>

  <footer>
    ¬© <span id="year"></span> Santa ¬∑ Hecho con ‚ô•
  </footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAou7COlKKf0mJCnwEefntTKVGI2cxxJrU",
  authDomain: "santa-roti.firebaseapp.com",
  projectId: "santa-roti",
  storageBucket: "santa-roti.firebasestorage.app",
  messagingSenderId: "66221970620",
  appId: "1:66221970620:web:53083ce7727ff85e6d2cb9",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const state = { cart: {} };
const currency = new Intl.NumberFormat('es-AR',{ style:'currency', currency:'ARS', maximumFractionDigits:0 });

function renderCart() {
  const list = document.getElementById('cartList');
  list.innerHTML = '';
  let total = 0;
  Object.values(state.cart).forEach(({ product, extra }) => {
    const itemTotal = product.price + (extra ? 3000 : 0);
    total += itemTotal;

    const row = document.createElement('div');
    row.className = 'cart-item';
    row.innerHTML = `
      <div>
        <div class="title">${product.name}</div>
        ${product.category === 'hamburguesa' ? `<label style="font-size:12px;"><input type="checkbox" class="extra-checkbox" data-id="${product.uid}" ${extra ? 'checked' : ''}> Agrandar Pedido +$3.000</label>` : ''}
      </div>`;
    list.appendChild(row);
  });

  // Manejo de checkbox ‚ÄúAgrandar Pedido‚Äù
  list.querySelectorAll('.extra-checkbox').forEach(chk => {
    chk.addEventListener('change', (e) => {
      const uid = e.target.getAttribute('data-id');
      if(state.cart[uid]) state.cart[uid].extra = e.target.checked;
      renderCart();
    });
  });

  document.getElementById('total').textContent = currency.format(total);
}

function buildWhatsAppMessage() {
  const entries = Object.values(state.cart);
  if(entries.length===0) { alert('Agreg√° al menos 1 producto al carrito.'); return null; }
  const name = document.getElementById('customerName').value.trim();
  const addr = document.getElementById('customerAddress').value.trim();
  const notes = document.getElementById('customerNotes').value.trim();

  const lines = ['üßæ *Nuevo pedido ‚Äî Santa*',''];
  entries.forEach(({ product, extra }) => {
    const lineTotal = product.price + (extra ? 3000 : 0);
    lines.push(`‚Ä¢ ${product.name}${extra ? ' (Agrandado)' : ''} ‚Äî ${currency.format(lineTotal)}`);
  });
  const total = entries.reduce((acc,{product,extra})=>acc+product.price+(extra?3000:0),0);
  lines.push('',`*Total:* ${currency.format(total)}`);
  if(name) lines.push(`*Nombre:* ${name}`);
  if(addr) lines.push(`*Direcci√≥n:* ${addr}`);
  if(notes) lines.push(`*Notas:* ${notes}`);
  lines.push('','Enviado desde la web de pedidos ‚úÖ');
  return lines.join('\n');
}

document.getElementById('whatsBtn').addEventListener('click', () => {
  const msg = buildWhatsAppMessage();
  if(!msg) return;
  const url = `https://wa.me/+543537581341?text=${encodeURIComponent(msg)}`;
  window.open(url,'_blank');
});

// Desplegable categor√≠as
document.querySelectorAll('.category-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const targetId = btn.getAttribute('data-target');
    const grid = document.getElementById(targetId);
    grid.classList.toggle('show');
    btn.textContent = btn.textContent.includes('‚ñ∏') ? btn.textContent.replace('‚ñ∏','‚ñæ') : btn.textContent.replace('‚ñæ','‚ñ∏');
  });
});

onSnapshot(collection(db,"productos"), snapshot => {
  ['pizzas','hamburguesas','papas','menuEspecial','extras'].forEach(id => document.getElementById(id).innerHTML = '');
  
  snapshot.forEach(doc => {
    const p = doc.data();
    const id = doc.id;
    const card = document.createElement('div');
    card.className = 'card product';
    card.innerHTML = `
      <div class="img">${p.img ? `<img src="${p.img}" alt="${p.name}">` : `Imagen ${p.name}`}</div>
      <div>
        <h3>${p.name}</h3>
        <p>${p.desc}</p>
      </div>
      <div class="actions">
        <div class="price">${currency.format(p.price)}</div>
        <div class="qty">
          <button data-id="${id}" data-op="+">+</button>
        </div>
      </div>`;
    
    let containerId;
    switch(p.category) {
      case 'pizza': containerId = 'pizzas'; break;
      case 'hamburguesa': containerId = 'hamburguesas'; break;
      case 'papas': containerId = 'papas'; break;
      case 'menu especial': containerId = 'menuEspecial'; break;
      case 'extras': containerId = 'extras'; break;
      default: containerId = 'pizzas';
    }
    document.getElementById(containerId).appendChild(card);

    const btn = card.querySelector('button[data-op="+"]');
    btn.addEventListener('click', () => {
      const uid = id + '-' + Date.now(); // id √∫nico por cada instancia
      state.cart[uid] = { product: {...p, uid}, extra: false };
      renderCart();
    });
  });
});

document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
